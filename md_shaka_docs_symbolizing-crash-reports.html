<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Shaka Player Embedded: Symbolizing Crash Reports</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Shaka Player Embedded
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Symbolizing Crash Reports </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This doc describes how to manually symbolize a crash report on a release binary. This should be read both by partners who send crash reports and for us to actually symbolize it. This process can only be done if we have the debug info for the binary. This only happens for official builds that we release. If you build from source, you can do this yourself with the debug info in the build directory.</p>
<p>Release binaries are optimized and don't have debug info. This means there is no way to get a useful stack trace or to get useful info from local variables. Going from a memory address to a symbol and line number is symbolizing. This allows us to see the real stack trace.</p>
<h2>What is needed </h2>
<p>First, we obviously need the stack trace. The best option is a whole crash dump (e.g. a "core" file on linux). If you provide that, you're done. But we can work with a copy of the stack trace text and some extra info.</p>
<p>It is important that the entries show the memory address by itself or something like <code>foo.so+0x1234</code>. We need the exact bytes. Note that <code>ExportedMethod+0x123</code> is not useful, it needs to be absolute or relative to the dynamic library.</p>
<p>Next we'll need which exact library you used; this includes the version string, OS, and architecture. We'll also need the build ID of the library. Run one of the following commands to get it:</p>
<div class="fragment"><div class="line"># On Mac (or iOS with dynamic library):</div><div class="line">dwarfdump -u &lt;library.so&gt;</div><div class="line"># On iOS:</div><div class="line">dwarfdump -u &lt;library.framework/library&gt;</div><div class="line"># On Linux:</div><div class="line">readelf -n &lt;library.so&gt; | grep &quot;Build ID&quot;</div></div><!-- fragment --><p>Windows doesn't have an exact build ID. Instead just give the file version. This can be retrieved by right-clicking on the file and selecting "Details". Or in a PowerShell window, run:</p>
<div class="fragment"><div class="line">(Get-Command ./library.dll).FileVersionInfo.FileVersion</div></div><!-- fragment --><h3>Load address</h3>
<p>Lastly, we'll need the load address of the library in your executable. This is the address in the binary's memory where our library is loaded. Since this is a shared library, it can appear anywhere in memory. We need to map the address in the stack trace to relative to our library so we know what the code is.</p>
<p>It is IMPORTANT to get the load address for the same invocation the stack trace is from. Dynamic libraries can appear at different locations, so you need to use the same run to get the load address and the stack trace.</p>
<p>If you have a debugger open in Xcode, select <code>Debug &gt; Debug Workflow &gt; Shared Libraries...</code>. Then give us the address for our shared library.</p>
<p>If you have a debugger open in Visual Studio, open the "Modules" tab (if not open, select <code>Debug &gt; Windows &gt; Modules</code>). Then give us the "Address" for our library.</p>
<p>If you have a crash log from an iOS device, there is a section for <code>Binary Images:</code> that lists the shared libraries. We need the one that matches the build ID you got before. To get logs for an attached device, open Xcode and select <code>Window &gt; Devices and Simulators</code>, select your device and click the <code>View Device Logs</code> button.</p>
<p>If you have a crash dump for Mac or iOS and are using <code>lldb</code>, enter <code>image list</code> and give us the address for our library. It will probably be near the top.</p>
<p>If you have a core dump for Linux, open it in <code>gdb</code> and enter <code>info share</code> and give us the address for our library. It will probably be near the top.</p>
<p>If you have a core/minidump for Windows, open it in <code>cdb</code> or <code>windbg</code> and enter <code>lm</code> and give us the start address for our library.</p>
<h2>Symbolizing the stack trace </h2>
<p>First you need the debug info for the build. For Mac and iOS this is a <code>.dSYM</code> file. On Linux, we just strip the shared library, so it is just a <code>.so</code> file that has been renamed to <code>.so.debug</code>. Run the commands above to get the build ID and verify it matches what the report gave us.</p>
<p>For Mac and iOS, run the following command. This will print the function name, file, and line number for each address given. If the address can't be found it will just print the address itself.</p>
<div class="fragment"><div class="line">atos -o &lt;library.dSYM&gt; -l &lt;LOAD_ADDRESS&gt; &lt;ADDR1&gt; &lt;ADDR2&gt; ...</div></div><!-- fragment --><p>For Linux, subtract the load address from the address and enter it (as a hex number) into the following command. If it doesn't work, try subtracting one from the number.</p>
<div class="fragment"><div class="line">addr2line -Cf -j .text -e &lt;library.so.debug&gt; &lt;OFFSET1&gt; &lt;OFFSET2&gt; ...</div></div><!-- fragment --><p>For Windows, you'll need the <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/">Windows debugger tools</a> (not Visual Studio). This usually comes with the Windows SDK or the Windows Driver Kit. You then need to run <code>dbh.exe</code>, an interactive symbol viewer/searcher:</p>
<div class="fragment"><div class="line">$ dbh.exe -v library.pdb</div><div class="line"></div><div class="line">&gt; base &lt;LOAD_ADDRESS&gt;</div><div class="line">&gt; addr &lt;ADDR1&gt;</div><div class="line">   name : my_symbol</div><div class="line">   addr :   &lt;ADDR1&gt;</div><div class="line">   size : 0</div><div class="line">  flags : 400000</div><div class="line">   type : 0</div><div class="line">modbase :   7ff123456789</div><div class="line">  value :        0</div><div class="line">    reg : 0</div><div class="line">  scope : SymTagNull (0)</div><div class="line">    tag : SymTagPublicSymbol (a)</div><div class="line">  index : 12ab</div><div class="line"></div><div class="line">&gt; laddr &lt;ADDR1&gt;</div><div class="line">  file : C:\users\build\src\foo.cpp</div><div class="line">  line : 123</div><div class="line">  addr : &lt;ADDR1&gt;</div><div class="line">   key : 000000000000000</div></div><!-- fragment --><p>Note that <code>laddr</code> might not work for third-party static libraries if the line info isn't available; but the <code>addr</code> command should always work.</p>
<h2>Symbolizing crash dumps </h2>
<p>If you have a crash dump from an unknown program, you can still get debug info from it. This also can be done to add symbols to a debugger run if there was problems loading the symbols.</p>
<h3>Linux</h3>
<p>First, load the core dump (<code>gdb -c core</code>). Then find our library in the loaded shared library list (<code>info share</code>) and remember the start address. Last, load the symbols for our library (<code>add-symbol-file library.so.debug 0x12345</code>). You should now have symbols for all of our parts and can move around our code like normal.</p>
<h3>Mac</h3>
<p>For OSX core dumps, load the core dump (<code>lldb -c core</code>). Then add our dSYM file (<code>add-dsym library.dylib.dSYM</code>).</p>
<h3>Windows</h3>
<p>For Windows core/mini dumps, you can add the path to the folder containing the .pdb on the command-line. For example: <code>cdb -z core.dmp -y symbol_folder</code> or <code>windbg -z core.dmp -y symbol_folder</code>. If you have an existing session and don't have symbols, the run <code>.sympath+ symbol_folder</code> and <code>.reload</code>. Be sure to give the folder name and that the .pdb file hasn't been renamed. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

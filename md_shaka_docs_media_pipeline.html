<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Shaka Player Embedded: Media Pipeline Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Shaka Player Embedded
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Media Pipeline Design </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document describes how the core media pipeline works and how an app can replace pieces of it to implement them differently.</p>
<h2>Core types</h2>
<p>First is the frame types; these are used to store encoded (<a class="el" href="classshaka_1_1media_1_1EncodedFrame.html">EncodedFrame</a>) or decoded (<a class="el" href="classshaka_1_1media_1_1DecodedFrame.html">DecodedFrame</a>) frames. Each object represents a single frame and should maintain the lifetime of any pointers returned; the data pointers must be static and are valid so long as the frame is alive. To allow for shared lifetime management, all frames are stored in a <code>std::shared_ptr&lt;T&gt;</code>. Apps should subclass these to store their own data and ensure the frame data remains alive for the life of the object.</p>
<p>The <a class="el" href="classshaka_1_1media_1_1EncodedFrame.html">EncodedFrame</a> objects are created by the <a class="el" href="classshaka_1_1media_1_1Demuxer.html">Demuxer</a>; the <a class="el" href="classshaka_1_1media_1_1DecodedFrame.html">DecodedFrame</a> objects are created by the <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a> (if using <a class="el" href="classshaka_1_1media_1_1DefaultMediaPlayer.html">DefaultMediaPlayer</a>). The library-provided types don't care about the specific implementation of the <a class="el" href="classshaka_1_1media_1_1EncodedFrame.html">EncodedFrame</a> and <a class="el" href="classshaka_1_1media_1_1DecodedFrame.html">DecodedFrame</a> types, so apps are free to create subclasses and still use other library-provided defaults.</p>
<p>Each frame has a <a class="el" href="classshaka_1_1media_1_1StreamInfo.html">StreamInfo</a> that is used to tell what stream it comes from. Frames coming from the same stream will have pointers to the same <a class="el" href="classshaka_1_1media_1_1StreamInfo.html">StreamInfo</a> object. The <a class="el" href="classshaka_1_1media_1_1StreamInfo.html">StreamInfo</a> instance can be used to initialize decoders or renderers.</p>
<p>Buffers of frames are stored in the <a class="el" href="classshaka_1_1media_1_1Stream.html">Stream</a> type. There is <a class="el" href="namespaceshaka_1_1media.html#af014aba5866315c03050cae89e76748f">ElementaryStream</a> and <a class="el" href="namespaceshaka_1_1media.html#a86c9bd2a954374e5fdd38df707b649f6">DecodedStream</a> for the <a class="el" href="classshaka_1_1media_1_1EncodedFrame.html">EncodedFrame</a> and <a class="el" href="classshaka_1_1media_1_1DecodedFrame.html">DecodedFrame</a> types respectively. Alternatively apps can use <code>Stream&lt;T, OrderByDts&gt;</code> to store a collection of their own types. A Stream stores the frames in time order (PTS or DTS based on the <code>OrderByDts</code> parameter). Streams only store one kind of frame (i.e. video-only or audio-only).</p>
<h2>MediaPlayer</h2>
<p>The <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a> is the top-level handler for all media interactions. It is responsible for loading and playing content. The library provides the <a class="el" href="classshaka_1_1media_1_1DefaultMediaPlayer.html">DefaultMediaPlayer</a> which handles timeline tracking but provides other plugins allowing apps to replace the <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a> or <a class="el" href="classshaka_1_1media_1_1Renderer.html">Renderer</a>. The <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a> operates in two modes, MSE and src= mode.</p>
<p>In MSE mode, data is given to a <a class="el" href="classshaka_1_1media_1_1Demuxer.html">Demuxer</a> and placed into an <a class="el" href="namespaceshaka_1_1media.html#af014aba5866315c03050cae89e76748f">ElementaryStream</a>. These streams are given to the <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a>. Then the <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a> will handle reading, decoding, and rendering those frames.</p>
<p>In src= mode, the <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a> is given a URL to read from. It is expected to read that file to get the data. Then it will play it similar to MSE mode.</p>
<p>When apps create a <a class="el" href="classshaka_1_1Player.html">Player</a> instance, they will need to pass in the <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a> instance they want to play with. This will act similar to the <code>&lt;video&gt;</code> element given in JavaScript.</p>
<h2>Demuxer</h2>
<p>The <a class="el" href="classshaka_1_1media_1_1Demuxer.html">Demuxer</a> is used when playing MSE content. This type is responsible for reading the bytes from the stream and producing <a class="el" href="classshaka_1_1media_1_1EncodedFrame.html">EncodedFrame</a> objects. This type should do so synchronously and will be called on a background thread. This is registered by creating an implementation of <a class="el" href="classshaka_1_1media_1_1DemuxerFactory.html">DemuxerFactory</a> and giving it to <a class="el" href="classshaka_1_1media_1_1DemuxerFactory.html#aa41959044476151942ddaff732af109d">DemuxerFactory::SetFactory</a>. Passing <code>nullptr</code> to this method will cause the built-in <a class="el" href="classshaka_1_1media_1_1Demuxer.html">Demuxer</a> to be used.</p>
<p>One <a class="el" href="classshaka_1_1media_1_1Demuxer.html">Demuxer</a> instance is created per input stream by the core library. For example, one <a class="el" href="classshaka_1_1media_1_1Demuxer.html">Demuxer</a> instance will handle video and the other will handle audio. Changing the <a class="el" href="classshaka_1_1media_1_1DemuxerFactory.html">DemuxerFactory</a> will not change any existing <a class="el" href="classshaka_1_1media_1_1Demuxer.html">Demuxer</a> instances that are already being used.</p>
<h2>Decoder</h2>
<p>The <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a> is only used if using the <a class="el" href="classshaka_1_1media_1_1DefaultMediaPlayer.html">DefaultMediaPlayer</a>. If providing your own <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a> implementation, you don't need to use/provide a <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a>. The <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a> is used to read <a class="el" href="classshaka_1_1media_1_1EncodedFrame.html">EncodedFrame</a> objects and decode them into <a class="el" href="classshaka_1_1media_1_1DecodedFrame.html">DecodedFrame</a> objects. A <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a> is only used to decode one kind of media, but may be required to decode different input streams. It should automatically check the <a class="el" href="classshaka_1_1media_1_1StreamInfo.html">StreamInfo</a> and re-initialize as required.</p>
<p>Custom <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a> implementations are given to <a class="el" href="classshaka_1_1media_1_1DefaultMediaPlayer.html#a26c8ccdd6b1bbe81746e890bab3cfa8c">DefaultMediaPlayer::SetDecoders</a>. Passing <code>nullptr</code> to either will cause the built-in decoders to be used.</p>
<h2>Renderer</h2>
<p>The <a class="el" href="classshaka_1_1media_1_1Renderer.html">Renderer</a> is only used if using the <a class="el" href="classshaka_1_1media_1_1DefaultMediaPlayer.html">DefaultMediaPlayer</a>. If providing your own <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a> implementation, you don't need to use/provide a <a class="el" href="classshaka_1_1media_1_1Renderer.html">Renderer</a>. They are also only used for MSE playback. The <a class="el" href="classshaka_1_1media_1_1Renderer.html">Renderer</a> is used to read <a class="el" href="classshaka_1_1media_1_1DecodedFrame.html">DecodedFrame</a> objects and either show them on the screen or play on an audio device. This is expected to, on a background thread, pull frames and update the data as needed. This can be done as part of audio callbacks, or with an explicit background thread. The <a class="el" href="classshaka_1_1media_1_1Renderer.html">Renderer</a> will be given the <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a> instance so it can read the current time, playback rate, etc that are needed to show the content.</p>
<p>On Desktop, we provide an <a class="el" href="classshaka_1_1media_1_1SdlAudioRenderer.html">SdlAudioRenderer</a>, <a class="el" href="classshaka_1_1media_1_1SdlManualVideoRenderer.html">SdlManualVideoRenderer</a>, and <a class="el" href="classshaka_1_1media_1_1SdlThreadVideoRenderer.html">SdlThreadVideoRenderer</a> types for use with SDL. On iOS, we don't expose the iOS renderers; we expect iOS users to use the <a class="el" href="interfaceShakaPlayerView.html">ShakaPlayerView</a>.</p>
<p><a class="el" href="classshaka_1_1media_1_1Renderer.html">Renderer</a> instances are given to the <a class="el" href="classshaka_1_1media_1_1DefaultMediaPlayer.html">DefaultMediaPlayer</a> constructor.</p>
<h2>Encryption support</h2>
<p>Encryption support comes through the <a class="el" href="classshaka_1_1eme_1_1Implementation.html">Eme Implementation</a> and <a class="el" href="classshaka_1_1eme_1_1ImplementationFactory.html">ImplementationFactory</a> types. Once an EME instance is created, it is given to the <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a>. If using the <a class="el" href="classshaka_1_1media_1_1DefaultMediaPlayer.html">DefaultMediaPlayer</a>, it will be given to the <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a> and the <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a> will decrypt and decode the frame as needed. In this case, it is assumed the frames are decoded into the clear. This allows supporting secure decrypt-decode, but doesn't allow for secure rendering.</p>
<p>Apps can use secure rendering by providing their own <a class="el" href="classshaka_1_1media_1_1MediaPlayer.html">MediaPlayer</a> instance. Since this case doesn't allow clear frames in memory, the <a class="el" href="classshaka_1_1media_1_1DefaultMediaPlayer.html">DefaultMediaPlayer</a> cannot handle it. You'll need to handle all the media playback.</p>
<h2>Removing defaults</h2>
<p>When running <code>./configure</code>, you can disable default media components you don't need when providing your own replacements. When these are used, the app will need to provide their own overrides or playback won't work.</p>
<ul>
<li><code>--no-media-player</code>: Removes the <a class="el" href="classshaka_1_1media_1_1DefaultMediaPlayer.html">DefaultMediaPlayer</a>. This also implies <code>--no-decoder</code>, <code>--no-sdl-audio</code>, and <code>--no-sdl-video</code>.</li>
<li><code>--no-demuxer</code>: Removes the default <a class="el" href="classshaka_1_1media_1_1Demuxer.html">Demuxer</a> implementation.</li>
<li><code>--no-decoder</code>: Removes the default <a class="el" href="classshaka_1_1media_1_1Decoder.html">Decoder</a> implementation.</li>
<li><code>--no-sdl-audio</code>: Removes the <a class="el" href="classshaka_1_1media_1_1SdlAudioRenderer.html">SdlAudioRenderer</a>.</li>
<li><code>--no-sdl-video</code>: Removes the <a class="el" href="classshaka_1_1media_1_1SdlManualVideoRenderer.html">SdlManualVideoRenderer</a> and <a class="el" href="classshaka_1_1media_1_1SdlThreadVideoRenderer.html">SdlThreadVideoRenderer</a>. This is the default on iOS. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
